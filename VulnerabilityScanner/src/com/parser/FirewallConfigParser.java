package com.parser;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.util.ArrayList;

import org.apache.log4j.LogManager;
import org.apache.log4j.Logger;

import com.firewall.CreateOpenstackFirewallFromConfig;
import com.global.Globals;
import com.google.gson.Gson;
import com.google.gson.stream.JsonReader;
import com.model.Firewall;

public class FirewallConfigParser {

	private static Logger LOGGER = LogManager.getLogger(FirewallConfigParser.class);

	public ArrayList<Firewall> parseFiles() {

		Gson gson = new Gson();

		ArrayList<Firewall> firewalls = new ArrayList<Firewall>();
		File folder = new File(Globals.firewallConfigFolder);
		// Get array of files from specified firewall config folder
		File[] listOfFiles = folder.listFiles();

		try {

			// Iterate over firewall config files
			for (int i = 0; i < listOfFiles.length; i++) {

				// Load current file as JSON
				JsonReader reader = new JsonReader(new FileReader(listOfFiles[i].getAbsolutePath().toString()));
				Firewall firewall = gson.fromJson(reader, Firewall.class);
				firewalls.add(firewall);

			}
		}

		catch (Exception e) {

			LOGGER.error("Firewall configs not loaded: " + e.getMessage());
			return null;
		}

		LOGGER.info("Firewall templates loaded.");
		return firewalls;

	}
}
